name: 'Scheduled Trivy Scan'

on:
  schedule:
    # Runs twice a week: Monday and Thursday at 09:00 UTC
    - cron: '0 9 * * 1,4'
  workflow_dispatch: # Allow manual trigger

jobs:
  trivy-scan:
    name: Trivy Scan + Linear Ticket
    uses: atlanhq/.github/.github/workflows/reusable-trivy-scan-scheduled.yml@main
    with:
      image_context: '.'
      dockerfile: './Dockerfile'
      image_tag: 'application-sdk:trivy-scan'
      scan_uv_lock: true
      uv_lock_path: 'uv.lock'
      severity: 'CRITICAL,HIGH'
      ignore_unfixed: true
      linear_priority: 2
      skip_ticket_on_clean: true
      service_name: 'Application SDK'
      registry_login: true
      registry_url: 'cgr.dev'
    secrets:
      LINEAR_TEAM_ID: ${{ secrets.LINEAR_TEAM_ID }}
      LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
      REGISTRY_USERNAME: ${{ secrets.CHAINGUARD_USERNAME }}
      REGISTRY_PASSWORD: ${{ secrets.CHAINGUARD_PASSWORD }}
