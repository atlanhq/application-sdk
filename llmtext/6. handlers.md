# Application SDK Handlers Documentation

This document provides comprehensive documentation for the Application SDK's handlers module, which implements the core handler interfaces and SQL-specific handlers.

## Table of Contents
1. [Base Handler Interface](#base-handler-interface)
2. [SQL Handler](#sql-handler)
3. [Constants](#constants)
4. [Usage Examples](#usage-examples)

## Base Handler Interface

### HandlerInterface
Abstract base class for workflow handlers.

**Methods:**
- `load(**kwargs: Any) -> None`: Abstract method to load the handler
- `test_auth(**kwargs: Any) -> bool`: Abstract method to test authentication credentials
- `preflight_check(*args, **kwargs: Any) -> Any`: Abstract method to perform preflight checks
- `fetch_metadata(**kwargs: Any) -> Any`: Abstract method to fetch metadata

## SQL Handler

### SQLConstants
Constants for SQL handler configuration.

**Values:**
- `DATABASE_ALIAS_KEY`: Key for database alias ("catalog_name")
- `SCHEMA_ALIAS_KEY`: Key for schema alias ("schema_name")
- `DATABASE_RESULT_KEY`: Key for database result ("TABLE_CATALOG")
- `SCHEMA_RESULT_KEY`: Key for schema result ("TABLE_SCHEMA")

### SQLHandler
Handler class for SQL workflows.

**Attributes:**
- `sql_client`: SQL client instance
- `test_authentication_sql`: SQL query for testing authentication
- `metadata_sql`: SQL query for fetching metadata
- `tables_check_sql`: SQL query for checking tables
- `fetch_databases_sql`: SQL query for fetching databases
- `fetch_schemas_sql`: SQL query for fetching schemas
- `database_alias_key`: Key for database alias
- `schema_alias_key`: Key for schema alias
- `database_result_key`: Key for database result
- `schema_result_key`: Key for schema result
- `temp_table_regex_sql`: SQL regex for temporary tables

**Methods:**
- `__init__(sql_client: SQLClient | None = None)`: Initialize handler with optional SQL client
- `load(credentials: Dict[str, Any]) -> None`: Load and initialize SQL client
- `prepare_metadata(sql_input: pd.DataFrame, **kwargs) -> List[Dict[Any, Any]]`: Prepare metadata from SQL results
- `test_auth(sql_input: pd.DataFrame, **kwargs) -> bool`: Test authentication credentials
- `fetch_metadata(metadata_type: Optional[MetadataType] = None, database: Optional[str] = None) -> List[Dict[str, str]]`: Fetch metadata based on type
- `fetch_databases() -> List[Dict[str, str]]`: Fetch database information
- `fetch_schemas(database: str) -> List[Dict[str, str]]`: Fetch schemas for specific database
- `preflight_check(payload: Dict[str, Any]) -> Dict[str, Any]`: Perform preflight checks
- `check_schemas_and_databases(payload: Dict[str, Any]) -> Dict[str, Any]`: Check schemas and databases
- `extract_allowed_schemas(schemas_results: List[Dict[str, str]]) -> Tuple[Set[str], Set[str]]`: Extract allowed schemas
- `validate_filters(include_filter: Dict[str, List[str] | str], allowed_databases: Set[str], allowed_schemas: Set[str]) -> Tuple[bool, str]`: Validate filters
- `tables_check(sql_input: pd.DataFrame, **kwargs) -> Dict[str, Any]`: Check tables

## Usage Examples

### Basic Handler Usage
```python
# Initialize handler
handler = SQLHandler(sql_client=SQLClient())

# Load credentials
await handler.load(credentials={
    "host": "localhost",
    "port": 5432,
    "username": "user",
    "password": "pass"
})

# Test authentication
is_valid = await handler.test_auth()

# Fetch metadata
metadata = await handler.fetch_metadata(
    metadata_type=MetadataType.ALL
)

# Perform preflight check
check_result = await handler.preflight_check({
    "metadata": {
        "include-filter": '{"db1": ["schema1"]}',
        "exclude-filter": '{"db1": ["temp"]}'
    }
})
```

### Database Operations
```python
# Fetch databases
databases = await handler.fetch_databases()

# Fetch schemas for a database
schemas = await handler.fetch_schemas("my_database")

# Prepare metadata
metadata = await handler.prepare_metadata(sql_input)
```

## Error Handling

### Authentication Errors
- Invalid credentials
- Connection failures
- Query execution errors

### Metadata Errors
- Invalid metadata type
- Missing database information
- Query execution errors

### Preflight Check Errors
- Schema validation failures
- Table check failures
- Filter validation errors

## Best Practices

1. Always implement proper error handling
2. Use appropriate SQL queries for each operation
3. Validate input parameters
4. Handle database connections properly
5. Implement proper logging
6. Use appropriate data structures for results
7. Follow SQL best practices
8. Implement proper cleanup
9. Use appropriate transaction management
10. Handle timeouts appropriately 