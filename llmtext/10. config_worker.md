# Configuration and Worker Documentation

This document provides a comprehensive overview of the Application SDK's configuration and worker modules, which handle application settings and Temporal worker management.

## Configuration (`config.py`)

The configuration module provides centralized settings management using Pydantic's BaseSettings.

### ApplicationSDKSettings
```python
class ApplicationSDKSettings(BaseSettings):
    """Central configuration for application-sdk.
    
    This class uses Pydantic's BaseSettings which allows for configuration via environment
    variables and/or direct assignment. Environment variables take precedence over defaults.
    
    Environment Variables:
        ATLAN_APP_SDK_CHUNK_SIZE: Chunk size for SQL | JSON | Parquet | Iceberg I/0 query operations
        
    Attributes:
        chunk_size (int): Chunk size for I/O operations (default: 100000)
            Applies to Iceberg, Parquet, JSON, and SQL operations
    """
    
    model_config = SettingsConfigDict(
        env_prefix="ATLAN_APP_SDK_",
        case_sensitive=False,
        extra="allow",  # Allow extra fields for future extensibility
    )
    
    chunk_size: int = 100000
    
    def model_dump(self, *args: Any, **kwargs: Any) -> Dict[str, Any]:
        """Get settings as a dictionary."""
        return super().model_dump(*args, **kwargs)
        
    @classmethod
    def get_settings(cls, **kwargs: Any) -> "ApplicationSDKSettings":
        """Create settings with optional overrides."""
        return cls(**kwargs)
```

### Global Settings Management
```python
# Global settings instance with default values
settings = ApplicationSDKSettings()

@lru_cache()
def get_settings() -> ApplicationSDKSettings:
    """Get the global settings instance.
    
    Returns:
        ApplicationSDKSettings: The global settings instance
        
    Note:
        This function is cached to avoid re-reading environment variables.
        To refresh settings, call get_settings.cache_clear()
    """
    return settings

def configure_settings(**kwargs: Any) -> None:
    """Configure global settings with overrides.
    
    Args:
        **kwargs: Keyword arguments to override default settings
        
    Example:
        >>> configure_settings(chunk_size=50000)
    """
    global settings
    settings = ApplicationSDKSettings.get_settings(**kwargs)
    # Clear the cache to ensure get_settings returns the new values
    get_settings.cache_clear()
```

## Worker (`worker.py`)

The worker module provides functionality for managing Temporal workflow workers.

### Worker Class
```python
class Worker:
    """Worker class for managing Temporal workflow workers.
    
    This class handles the initialization and execution of Temporal workers,
    including their activities, workflows, and module configurations.
    
    Attributes:
        temporal_client (TemporalClient | None): Client for interacting with Temporal
        temporal_worker: The Temporal worker instance
        temporal_activities (Sequence[CallableType]): List of activity functions
        workflow_classes (List[Any]): List of workflow classes
        passthrough_modules (List[str]): List of module names to pass through
        max_concurrent_activities (int | None): Maximum number of concurrent activities
    """
    
    def __init__(
        self,
        temporal_client: TemporalClient | None = None,
        temporal_activities: Sequence[CallableType] = [],
        passthrough_modules: List[str] = ["application_sdk", "os"],
        workflow_classes: List[Any] = [],
        max_concurrent_activities: Optional[int] = None,
    ):
        """Initialize the Worker.
        
        Args:
            temporal_client: Client for interacting with Temporal
            temporal_activities: List of activity functions
            passthrough_modules: List of module names to pass through
            workflow_classes: List of workflow classes
            max_concurrent_activities: Maximum number of concurrent activities
        """
        
    async def start(self, daemon: bool = False, *args: Any, **kwargs: Any) -> None:
        """Start the Temporal worker.
        
        Args:
            daemon: Whether to run the worker in a daemon thread
            *args: Additional positional arguments
            **kwargs: Additional keyword arguments
            
        Raises:
            ValueError: If temporal_client is not set
            
        Note:
            When running as a daemon, the worker runs in a separate thread and
            does not block the main thread.
        """
```

## Common Features and Best Practices

### Configuration Management
1. Environment Variables
   - Case-insensitive matching
   - Environment variable precedence
   - Prefix-based configuration

2. Settings Management
   - Cached settings access
   - Dynamic configuration updates
   - Type-safe settings

3. Extensibility
   - Extra field support
   - Override capabilities
   - Default value handling

### Worker Management
1. Worker Initialization
   - Client configuration
   - Activity registration
   - Workflow class registration
   - Module passthrough

2. Execution Modes
   - Synchronous execution
   - Daemon thread support
   - Concurrent activity handling

3. Error Handling
   - Client validation
   - Exception logging
   - Graceful shutdown

### Best Practices
1. Configuration
   - Use environment variables
   - Cache settings access
   - Type-safe settings
   - Clear defaults

2. Worker Setup
   - Proper client initialization
   - Activity registration
   - Workflow registration
   - Resource management

3. Error Handling
   - Validate inputs
   - Log errors
   - Handle exceptions
   - Clean up resources

4. Performance
   - Cache settings
   - Optimize worker threads
   - Manage concurrent activities
   - Monitor resource usage 